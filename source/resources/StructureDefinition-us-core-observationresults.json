{
  "resourceType": "StructureDefinition",
  "id": "us-core-observationresults",
  "url": "http://hl7.org/fhir/us/core-r4/StructureDefinition/us-core-observationresults",
  "version": "4.0.0",
  "name": "USCoreResultObservationProfile",
  "title": "US Core Result Observation Profile",
  "status": "active",
  "date": "2016-08-01",
  "publisher": "HL7 US Realm Steering Committee",
  "description": "Defines constraints and extensions on the Observation resource for the minimal set of data to query and retrieve Result information.",
  "fhirVersion": "4.0.0",
  "mapping": [
    {
      "identity": "argonaut-dq-dstu2",
      "uri": "http://unknown.org/Argonaut-DQ-DSTU2",
      "name": "Argonaut-DQ-DSTU2"
    },
    {
      "identity": "workflow",
      "uri": "http://hl7.org/fhir/workflow",
      "name": "Workflow Pattern"
    },
    {
      "identity": "sct-concept",
      "uri": "http://snomed.info/conceptdomain",
      "name": "SNOMED CT Concept Domain Binding"
    },
    {
      "identity": "v2",
      "uri": "http://hl7.org/v2",
      "name": "HL7 v2 Mapping"
    },
    {
      "identity": "rim",
      "uri": "http://hl7.org/v3",
      "name": "RIM Mapping"
    },
    {
      "identity": "w5",
      "uri": "http://hl7.org/fhir/fivews",
      "name": "FiveWs Pattern Mapping"
    },
    {
      "identity": "sct-attr",
      "uri": "http://snomed.org/attributebinding",
      "name": "SNOMED CT Attribute Binding"
    }
  ],
  "kind": "resource",
  "abstract": false,
  "type": "Observation",
  "baseDefinition": "http://hl7.org/fhir/StructureDefinition/Observation",
  "derivation": "constraint",
  "differential": {
    "element": [
      {
        "id": "Observation",
        "path": "Observation",
        "short": "US Core Result Observation",
        "definition": "The US Core Observation Result Profile is based upon the core FHIR Observation Resource and created to meet the 2015 Edition Common Clinical Data Set 'Laboratory test(s) and Laboratory value(s)/result(s)' requirements.",
        "alias": [
          "Obs"
        ],
        "constraint": [
          {
            "key": "us-core-2",
            "severity": "error",
            "human": "If there is no component or related element then either a value[x] or a data absent reason must be present",
            "expression": "(component.empty() and related.empty()) implies (dataAbsentReason or value)",
            "xpath": "exists(f:component) or exists(f:related) or exists(f:*[starts-with(local-name(.), 'value)]) or exists(f:dataAbsentReason)"
          }
        ],
        "mustSupport": false,
        "isModifier": false,
        "mapping": [
          {
            "identity": "argonaut-dq-dstu2",
            "map": "Observation"
          }
        ]
      },
      {
        "id": "Observation.status",
        "path": "Observation.status",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "code"
          }
        ],
        "mustSupport": true,
        "isModifier": false,
        "binding": {
          "strength": "required",
          "valueSet": "http://hl7.org/fhir/ValueSet/observation-status"
        },
        "mapping": [
          {
            "identity": "argonaut-dq-dstu2",
            "map": "Observation.status"
          }
        ]
      },
      {
        "id": "Observation.category",
        "path": "Observation.category",
        "min": 1,
        "max": "*",
        "type": [
          {
            "code": "CodeableConcept"
          }
        ],
        "constraint": [
          {
            "key": "us-core-5",
            "severity": "error",
            "human": "Must have a category of 'laboratory' and a code system 'http://hl7.org/fhir/observation-category'",
            "expression": "where(coding.system='http://hl7.org/fhir/observation-category' and coding.code='laboratory').exists()",
            "xpath": "exists(f:coding/code[@value='laboratory']) and exists(f:coding/system[@value='http://hl7.org/fhir/observation-category'])"
          }
        ],
        "mustSupport": true,
        "isModifier": false,
        "mapping": [
          {
            "identity": "argonaut-dq-dstu2",
            "map": "Observation.category"
          }
        ]
      },
      {
        "id": "Observation.code",
        "path": "Observation.code",
        "short": "Laboratory Test Name",
        "definition": "The test that was performed.  A LOINC **SHALL** be used if the concept is present in LOINC.",
        "comment": "The typical patterns for codes are:  1)  a LOINC code either as a  translation from a \"local\" code or as a primary code, or 2)  a local code only if no suitable LOINC exists,  or 3)  both the local and the LOINC translation.   Systems SHALL be capable of sending the local code if one exists.  When using LOINC , Use either the SHORTNAME or LONG_COMMON_NAME field for the display.",
        "alias": [
          "Test Name",
          "Observation Identifer"
        ],
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "CodeableConcept"
          }
        ],
        "mustSupport": true,
        "isModifier": false,
        "binding": {
          "strength": "extensible",
          "description": "LOINC codes",
          "valueSet": "http://hl7.org/fhir/ValueSet/observation-codes"
        },
        "mapping": [
          {
            "identity": "argonaut-dq-dstu2",
            "map": "Observation.code"
          }
        ]
      },
      {
        "id": "Observation.subject",
        "path": "Observation.subject",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "http://hl7.org/fhir/us/core-r4/StructureDefinition/us-core-patient"
            ]
          }
        ],
        "mustSupport": true,
        "isModifier": false,
        "mapping": [
          {
            "identity": "argonaut-dq-dstu2",
            "map": "Observation.subject"
          }
        ]
      },
      {
        "id": "Observation.effective[x]",
        "path": "Observation.effective[x]",
        "definition": "For lab tests this is the specimen collection date.  For Ask at Order Entry Questions (AOE)'s this is the date the question was asked.",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "dateTime"
          },
          {
            "code": "Period"
          }
        ],
        "constraint": [
          {
            "key": "us-core-1",
            "severity": "error",
            "human": "Datetime must be at least to day.",
            "expression": "($this as dateTime).toString().length() >= 8",
            "xpath": "f:matches(effectiveDateTime,/\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d([+-][0-2]\\d:[0-5]\\d|Z)/)"
          }
        ],
        "mustSupport": true,
        "isModifier": false,
        "mapping": [
          {
            "identity": "argonaut-dq-dstu2",
            "map": "Observation.effective[x]"
          }
        ]
      },
      {
        "id": "Observation.value[x]",
        "path": "Observation.value[x]",
        "short": "Result Value",
        "definition": "The Laboratory result value.  If a coded value,  the valueCodeableConcept.code **SHOULD**  be selected from [SNOMED CT](http://hl7.org/fhir/ValueSet/uslab-obs-codedresults).  If a numeric value, valueQuantity.code **SHALL** be selected from [UCUM](http://unitsofmeasure.org).  A FHIR [UCUM Codes value set](http://hl7.org/fhir/STU3/valueset-ucum-units.html) that defines all UCUM codes is in the FHIR specification.",
        "min": 0,
        "max": "1",
        "constraint": [
          {
            "extension": [
              {
                "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-bestpractice",
                "valueBoolean": true
              }
            ],
            "key": "us-core-4",
            "severity": "warning",
            "human": "SHOULD use Snomed CT for coded Results",
            "expression": "valueCodeableConcept.coding.system.empty() or valueCodeableConcept.coding.system = 'http://snomed.info/sct'",
            "xpath": "not(exists(f:valueCodeableConcept/f:coding/f:system) ) or  f:valueCodeableConcept/f:coding/f:system[@value='http://snomed.info/sct']"
          },
          {
            "key": "us-core-3",
            "severity": "error",
            "human": "SHALL use UCUM for coded quantity units.",
            "expression": "valueQuantity.system.empty() or valueQuantity.system = 'http://unitsofmeasure.org'",
            "xpath": "not(exists(f:valueQuantity/f:system) ) or  f:valueQuantity/f:system[@value='http://unitsofmeasure.org']"
          }
        ],
        "mustSupport": true,
        "isModifier": false,
        "mapping": [
          {
            "identity": "argonaut-dq-dstu2",
            "map": "Observation.value[x]"
          }
        ]
      },
      {
        "id": "Observation.dataAbsentReason",
        "path": "Observation.dataAbsentReason",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "CodeableConcept"
          }
        ],
        "mustSupport": true,
        "isModifier": false,
        "binding": {
          "strength": "extensible",
          "valueSet": "http://hl7.org/fhir/ValueSet/data-absent-reason"
        },
        "mapping": [
          {
            "identity": "argonaut-dq-dstu2",
            "map": "Observation.dataAbsentReason"
          }
        ]
      }
    ]
  }
}
